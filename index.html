<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üè¥‚Äç‚ò†Ô∏è Vecchia Dogana - Gestione Cassa</title>
  <link href="https://fonts.googleapis.com/css2?family=Pirata+One&family=Rye&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(rgba(20, 40, 60, 0.7), rgba(20, 40, 60, 0.7)),
                  url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%23234" width="100" height="100"/></svg>');
      min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;
    }
    .container {
      background: linear-gradient(145deg, #d4a574 0%, #a67c52 100%);
      padding: 50px 40px; border-radius: 15px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.6); max-width: 500px; width: 100%;
      border: 4px solid #6b4423; position: relative;
    }
    .logo { text-align: center; margin-bottom: 40px; }
    .logo h1 {
      font-family: 'Pirata One', cursive; font-size: 2.8em; color: #3d1f0f; margin-bottom: 5px;
      text-shadow: 2px 2px 0 #d4a574, 3px 3px 0 rgba(0,0,0,0.3); letter-spacing: 2px;
    }
    .logo .skull { font-size: 3em; display: block; margin-bottom: 10px; animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    .logo p { font-family: 'Rye', cursive; color: #2c1810; font-size: 1.1em; font-style: italic; }
    .btn-group { display: flex; flex-direction: column; gap: 20px; margin-top: 30px; }
    .btn {
      padding: 18px 30px; border: 3px solid #3d1f0f; border-radius: 8px; font-size: 1.2em;
      font-weight: 700; font-family: 'Rye', cursive; cursor: pointer; transition: all 0.3s;
      text-decoration: none; text-align: center; display: block; position: relative;
      box-shadow: 0 4px 0 #3d1f0f, 0 8px 20px rgba(0,0,0,0.4);
    }
    .btn:active { transform: translateY(4px); box-shadow: 0 0 0 #3d1f0f, 0 4px 10px rgba(0,0,0,0.4); }
    .btn-primary {
      background: linear-gradient(145deg, #e8b873 0%, #c89858 100%); color: #2c1810;
    }
    .btn-secondary {
      background: linear-gradient(145deg, #8b4513 0%, #654321 100%); color: #f4e4c1;
    }
    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: linear-gradient(145deg, #d4a574 0%, #a67c52 100%);
      padding: 40px; border-radius: 15px; max-width: 450px; width: 90%;
      border: 4px solid #6b4423; box-shadow: 0 30px 60px rgba(0,0,0,0.8);
    }
    .modal-content h2 {
      font-family: 'Pirata One', cursive; font-size: 2em; text-align: center;
      color: #2c1810; margin-bottom: 25px;
    }
    .form-group { margin-bottom: 25px; }
    .form-group label {
      display: block; margin-bottom: 8px; color: #2c1810;
      font-weight: 700; font-family: 'Rye', cursive; font-size: 1.1em;
    }
    .form-group input {
      width: 100%; padding: 15px; border: 3px solid #6b4423; border-radius: 8px;
      font-size: 1.3em; font-family: monospace; font-weight: bold;
      text-align: center; letter-spacing: 8px; background: #f4e4c1; color: #2c1810;
    }
    .modal-buttons { display: flex; gap: 15px; margin-top: 25px; }
    .modal-buttons button { flex: 1; }
    .btn-cancel {
      background: linear-gradient(145deg, #8b8b8b 0%, #5a5a5a 100%); color: #f4e4c1;
    }
    #errorePin {
      color: #8b0000; background: #ffcccc; padding: 12px; border-radius: 8px;
      margin-top: 15px; display: none; text-align: center; font-weight: bold; border: 2px solid #8b0000;
    }
    .footer {
      text-align: center; margin-top: 30px; color: #d4a574; font-size: 0.95em;
      font-style: italic; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    @media (max-width: 600px) {
      .container { padding: 30px 20px; }
      .logo h1 { font-size: 2em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <span class="skull">üè¥‚Äç‚ò†Ô∏è</span>
      <h1>Vecchia Dogana</h1>
      <p>Gestione del Tesoro della Cassa</p>
    </div>
    <div class="btn-group">
      <a href="chiusura.html" class="btn btn-primary">üìú Registra Chiusura Cassa</a>
      <button class="btn btn-secondary" onclick="mostraModalPIN()">üé© Accesso Capitano</button>
    </div>
  </div>
  
  <div class="footer">
    <p>‚öì Sviluppato da Studio Smart ‚öì</p>
  </div>
  
  <div id="modalPIN" class="modal">
    <div class="modal-content">
      <h2>Codice Segreto</h2>
      <div class="form-group">
        <label for="pinInput">PIN Capitano:</label>
        <input type="password" id="pinInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4">
      </div>
      <div class="modal-buttons">
        <button class="btn btn-cancel" onclick="chiudiModalPIN()">Indietro</button>
        <button class="btn btn-primary" onclick="verificaPIN()">Entra</button>
      </div>
      <div id="errorePin">‚ö†Ô∏è Codice errato! Riprova.</div>
    </div>
  </div>
  
  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzcpybXvlL5Ge24NztvVL3Kz8Jhd3jRHWH0KZmZgKW9577DIqsvXUH7h2lN4ZkzldHisQ/exec';
    
    async function callAPI(action, data = {}) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          redirect: 'follow',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ action: action, ...data })
        });
        
        const text = await response.text();
        return JSON.parse(text);
      } catch (error) {
        console.error('Errore API:', error);
        throw error;
      }
    }
    
    function mostraModalPIN() {
      document.getElementById('modalPIN').classList.add('active');
      document.getElementById('pinInput').focus();
    }
    
    function chiudiModalPIN() {
      document.getElementById('modalPIN').classList.remove('active');
      document.getElementById('pinInput').value = '';
      document.getElementById('errorePin').style.display = 'none';
    }
    
    async function verificaPIN() {
      const pin = document.getElementById('pinInput').value;
      if (!pin) { alert('‚ö†Ô∏è Inserisci il codice segreto!'); return; }
      
      try {
        const result = await callAPI('verificaPIN', { pin: pin });
        if (result.valido) {
          sessionStorage.setItem('auth', 'titolare');
          window.location.href = 'dashboard.html';
        } else {
          document.getElementById('errorePin').style.display = 'block';
          setTimeout(() => document.getElementById('errorePin').style.display = 'none', 3000);
        }
      } catch (error) {
        alert('‚ö†Ô∏è Errore di connessione: ' + error.message);
      }
    }
    
    document.getElementById('pinInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') verificaPIN();
    });
  </script>
</body>
</html>
